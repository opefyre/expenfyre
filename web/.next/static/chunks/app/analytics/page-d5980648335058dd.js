(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[745],{1486:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>S});var s=a(2381),n=a(665),r=a(4262),i=a(698),o=a(1444),l=a(4191),c=a(7720),d=a(8735),x=a(2509),m=a(9826),h=a(205),u=a(6496),g=a(3913),f=a(5361),p=a(9045),y=a(271),j=a(9613),b=a(1961),k=a(1924),v=a(4726);function w(){let[e,t]=(0,n.useState)(!1),[a,s]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{s(!0);let e=()=>{t(window.innerWidth<768||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),{isMobile:e,isClient:a}}function N(e){let{children:t,title:a,className:r="",height:i=300}=e,{isClient:o,isMobile:l}=w(),[c,d]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{if(o){let e=setTimeout(()=>{d(!0)},100*!!l);return()=>clearTimeout(e)}},[o,l]),o&&c)?(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-slate-200 dark:border-gray-700 p-6 ".concat(r),style:{minHeight:"".concat(i,"px")},children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-slate-900 dark:text-gray-100 mb-4",children:a}),(0,s.jsx)("div",{style:{width:"100%",height:"".concat(i-60,"px"),position:"relative",minHeight:"".concat(i-60,"px")},children:t})]}):(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-slate-200 dark:border-gray-700 p-6 ".concat(r),style:{minHeight:"".concat(i,"px")},children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-slate-900 dark:text-gray-100 mb-4",children:a}),(0,s.jsx)("div",{className:"flex items-center justify-center",style:{height:"".concat(i-60,"px")},children:(0,s.jsx)("div",{className:"text-slate-500 dark:text-gray-400",children:"Loading chart..."})})]})}function S(){let[e,t]=(0,n.useState)(null),[a,S]=(0,n.useState)([]),[_,M]=(0,n.useState)(null),[z,L]=(0,n.useState)([]),[P,E]=(0,n.useState)([]),[A,W]=(0,n.useState)([]),[D,U]=(0,n.useState)([]),{isMobile:B,isClient:O}=w(),{showLoading:C,hideLoading:F}=(0,o.M)(),{showSuccess:T,showError:H}=(0,l.Ax)();(0,n.useEffect)(()=>{I()},[]),(0,n.useEffect)(()=>{if(e){let e=setTimeout(()=>{K()},200);return()=>clearTimeout(e)}},[e]);let I=async()=>{C("Checking authentication...");try{let e=await (0,r.HW)();e?t(e):window.location.href="/"}catch(e){console.error("Auth check failed:",e),window.location.href="/"}finally{F()}},K=async()=>{try{C("Loading analytics...");let e=new URLSearchParams,[t,a,s,n,i,o]=await Promise.all([(0,r.Ud)("/api/analytics/summary?".concat(e.toString())),(0,r.Ud)("/api/categories"),(0,r.Ud)("/api/analytics/category-breakdown?".concat(e.toString())),(0,r.Ud)("/api/analytics/monthly-comparison?months=12"),(0,r.Ud)("/api/analytics/budget-performance?month=".concat(new Date().toISOString().substring(0,7))),(0,r.Ud)("/api/analytics/spending-velocity?days=30")]),[l,c,d,x,m,h]=await Promise.all([t.json(),a.json(),s.json(),n.json(),i.json(),o.json()]);l.success&&M(l.data),c.success&&S(c.data),d.success&&L(d.data),x.success&&E(x.data),m.success&&W(m.data),h.success&&U(h.data)}catch(e){console.error("Error loading analytics:",e),H("Failed to load analytics","Please try again later")}finally{F()}},R=async()=>{try{C("Signing out..."),await (0,r.Ud)("/api/auth/signout",{method:"POST"}),document.cookie="access_token=; Secure; SameSite=None; Path=/; Max-Age=0",document.cookie="refresh_token=; Secure; SameSite=None; Path=/; Max-Age=0",t(null),T("Signed out successfully!"),window.location.href="/"}catch(e){console.error("Sign out error:",e),H("Sign out failed","Please try again."),document.cookie="access_token=; Secure; SameSite=None; Path=/; Max-Age=0",document.cookie="refresh_token=; Secure; SameSite=None; Path=/; Max-Age=0",window.location.href="/"}finally{F()}},V=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR"}).format(e),X=e=>{let[t,a]=e.split("-");return new Date(parseInt(t),parseInt(a)-1).toLocaleDateString("en-US",{year:"numeric",month:"short"})},G=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#84cc16","#f97316","#ec4899","#6366f1"];return e?(0,s.jsx)(i.A,{user:e,currentPage:"/analytics",onSignOut:R,children:(0,s.jsxs)("div",{className:"h-full flex flex-col",children:[(0,s.jsx)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 flex-shrink-0",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-slate-900 dark:text-gray-100",children:"Analytics"}),(0,s.jsx)("p",{className:"text-sm text-slate-500 dark:text-gray-400 mt-1",children:"Key insights and trends for your expenses"})]})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto overflow-x-hidden w-full",children:(0,s.jsxs)("div",{className:"space-y-6 w-full max-w-full",children:[_&&(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 dark:from-blue-600 dark:to-blue-700 rounded-xl p-5 text-white",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm opacity-90",children:"Total Spent"}),(0,s.jsx)("svg",{className:"w-5 h-5 opacity-80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})]}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:V(_.total_expenses)}),(0,s.jsxs)("p",{className:"text-xs opacity-75 mt-1",children:[_.expense_count," transactions"]})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-br from-green-500 to-green-600 dark:from-green-600 dark:to-green-700 rounded-xl p-5 text-white",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm opacity-90",children:"Total Budget"}),(0,s.jsx)("svg",{className:"w-5 h-5 opacity-80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})]}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:V(_.total_budget)}),(0,s.jsxs)("p",{className:"text-xs opacity-75 mt-1",children:[_.budget_count," budgets"]})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-br from-amber-500 to-amber-600 dark:from-amber-600 dark:to-amber-700 rounded-xl p-5 text-white",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm opacity-90",children:"Avg. Expense"}),(0,s.jsx)("svg",{className:"w-5 h-5 opacity-80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})]}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:V(_.average_expense)}),(0,s.jsx)("p",{className:"text-xs opacity-75 mt-1",children:"per transaction"})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-br rounded-xl p-5 ".concat(_.budget_utilization>100?"from-red-500 to-red-600 dark:from-red-600 dark:to-red-700 text-white":_.budget_utilization>80?"from-orange-500 to-orange-600 dark:from-orange-600 dark:to-orange-700 text-white":"from-emerald-500 to-emerald-600 dark:from-emerald-600 dark:to-emerald-700 text-white"),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Budget Usage"}),(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})]}),(0,s.jsxs)("p",{className:"text-3xl font-bold",children:[_.budget_utilization.toFixed(1),"%"]}),(0,s.jsx)("p",{className:"text-xs mt-1 opacity-90",children:_.budget_utilization>100?"Over budget!":_.budget_utilization>80?"Near limit":"On track"})]})]}),P.length>0&&O&&(0,s.jsx)(N,{title:"Monthly Overview",height:B?250:300,children:(0,s.jsx)(c.u,{width:"100%",height:"100%",minHeight:B?200:250,children:(0,s.jsxs)(d.b,{data:P,margin:B?{top:5,right:5,left:5,bottom:5}:{top:5,right:30,left:20,bottom:5},children:[(0,s.jsx)(x.d,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,s.jsx)(m.W,{dataKey:"month",tick:{fontSize:B?10:12},tickFormatter:X,interval:B?"preserveStartEnd":0}),(0,s.jsx)(h.h,{tick:{fontSize:B?10:12}}),(0,s.jsx)(u.m,{formatter:e=>V(e),labelFormatter:X,contentStyle:B?{fontSize:"12px",padding:"8px"}:{}}),!B&&(0,s.jsx)(g.s,{}),(0,s.jsx)(f.N,{type:"monotone",dataKey:"total_expenses",name:"Expenses",stroke:"#ef4444",strokeWidth:B?2:3,dot:{fill:"#ef4444",strokeWidth:2,r:B?3:4},activeDot:{r:B?4:6,stroke:"#ef4444",strokeWidth:2}}),(0,s.jsx)(f.N,{type:"monotone",dataKey:"total_budget",name:"Budget",stroke:"#10b981",strokeWidth:B?2:3,dot:{fill:"#10b981",strokeWidth:2,r:B?3:4},activeDot:{r:B?4:6,stroke:"#10b981",strokeWidth:2}})]})},"monthly-".concat(B))}),D.length>0&&O&&(0,s.jsxs)(N,{title:"Spending Velocity & Transaction Patterns",height:B?350:450,children:[(0,s.jsx)("p",{className:"text-sm text-slate-600 mb-4",children:"Daily spending trends and individual transaction analysis over the last 30 days"}),(0,s.jsx)(c.u,{width:"100%",height:"100%",minHeight:B?280:350,children:(0,s.jsxs)(p.X,{data:D,margin:B?{top:5,right:5,left:5,bottom:5}:{top:5,right:30,left:20,bottom:5},children:[(0,s.jsx)(x.d,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,s.jsx)(m.W,{dataKey:"date",tick:{fontSize:B?10:12},tickFormatter:e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"}),interval:B?"preserveStartEnd":0}),(0,s.jsx)(h.h,{yAxisId:"left",tick:{fontSize:B?10:12}}),(0,s.jsx)(h.h,{yAxisId:"right",orientation:"right",tick:{fontSize:B?10:12}}),(0,s.jsx)(u.m,{content:e=>{let{active:t,payload:a,label:n}=e;if(t&&a&&a.length&&n){let e=a[0].payload;return(0,s.jsxs)("div",{className:"bg-white p-3 border border-slate-200 rounded-lg shadow-lg ".concat(B?"max-w-xs":""),children:[(0,s.jsx)("p",{className:"font-medium text-sm",children:new Date(n).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),(0,s.jsxs)("p",{className:"text-sm text-slate-600",children:["Daily Spending: ",V(e.daily_spending)]}),(0,s.jsxs)("p",{className:"text-sm text-slate-600",children:["Transactions: ",e.transaction_count]}),e.expenses.length>0&&!B&&(0,s.jsxs)("div",{className:"mt-2 max-h-32 overflow-y-auto",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-slate-700 mb-1",children:"Recent transactions:"}),e.expenses.slice(0,3).map((e,t)=>(0,s.jsxs)("div",{className:"text-xs text-slate-600",children:[V(e.amount)," - ",e.category_name]},t)),e.expenses.length>3&&(0,s.jsxs)("div",{className:"text-xs text-slate-500",children:["+",e.expenses.length-3," more..."]})]})]})}return null}}),!B&&(0,s.jsx)(g.s,{}),(0,s.jsx)(y.Gk,{yAxisId:"left",type:"monotone",dataKey:"daily_spending",name:"Daily Spending",fill:"#3b82f6",fillOpacity:.3,stroke:"#3b82f6",strokeWidth:B?1:2}),(0,s.jsx)(j.X,{yAxisId:"right",dataKey:"transaction_count",name:"Transaction Count",fill:"#f59e0b",r:B?2:4})]})},"velocity-".concat(B))]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[z.length>0&&O&&(0,s.jsx)(N,{title:"Spending by Category",className:"lg:col-span-1",height:B?250:300,children:(0,s.jsx)(c.u,{width:"100%",height:"100%",minHeight:B?200:250,children:(0,s.jsxs)(b.r,{children:[(0,s.jsx)(k.F,{data:z,dataKey:"total_amount",nameKey:"category_name",cx:"50%",cy:"50%",outerRadius:B?60:80,innerRadius:B?20:30,label:!B&&(e=>{let{category_name:t,percentage:a}=e;return a>5?"".concat(t,": ").concat(a.toFixed(1),"%"):""}),labelLine:!1,children:z.map((e,t)=>(0,s.jsx)(v.f,{fill:G[t%G.length]},"cell-".concat(t)))}),(0,s.jsx)(u.m,{formatter:(e,t,a)=>[V(e),"".concat(a.payload.category_name," (").concat(a.payload.percentage.toFixed(1),"%)")],labelStyle:{color:"#374151"},contentStyle:{backgroundColor:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"8px"}})]})},"category-".concat(B))}),A.length>0&&O&&(0,s.jsx)(N,{title:"Budget Performance",className:"lg:col-span-1",children:(0,s.jsx)("div",{className:"space-y-3 max-h-[300px] overflow-y-auto",children:A.map((e,t)=>(0,s.jsxs)("div",{className:"border border-slate-100 rounded-lg p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-slate-700",children:e.category_name}),(0,s.jsxs)("span",{className:"text-xs px-2 py-1 rounded-full ".concat("over"===e.status?"bg-red-100 text-red-700":"near"===e.status?"bg-orange-100 text-orange-700":"bg-green-100 text-green-700"),children:[e.utilization_percentage.toFixed(0),"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-slate-100 rounded-full h-2 mb-2",children:(0,s.jsx)("div",{className:"h-2 rounded-full ".concat("over"===e.status?"bg-red-500":"near"===e.status?"bg-orange-500":"bg-green-500"),style:{width:"".concat(Math.min(e.utilization_percentage,100),"%")}})}),(0,s.jsxs)("div",{className:"flex justify-between text-xs text-slate-500",children:[(0,s.jsxs)("span",{children:["Spent: ",V(e.spent_amount)]}),(0,s.jsxs)("span",{children:["Budget: ",V(e.budget_amount)]})]})]},t))})})]})]})})]})}):null}},5632:(e,t,a)=>{Promise.resolve().then(a.bind(a,1486))}},e=>{e.O(0,[687,568,448,621,358],()=>e(e.s=5632)),_N_E=e.O()}]);