(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{1444:(e,t,s)=>{"use strict";s.d(t,{M:()=>i,o:()=>o});var n=s(2381),r=s(665);let a=(0,r.createContext)(void 0);function o(e){let{children:t}=e,[s,o]=(0,r.useState)(!1),[i,l]=(0,r.useState)("Loading..."),c=(0,r.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Loading...";o(e),l(t)},[]),u=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Loading...";c(!0,e)},[c]),d=(0,r.useCallback)(()=>{c(!1)},[c]);return(0,n.jsx)(a.Provider,{value:{isLoading:s,loadingMessage:i,setLoading:c,showLoading:u,hideLoading:d},children:t})}function i(){let e=(0,r.useContext)(a);if(void 0===e)throw Error("useLoading must be used within a LoadingProvider");return e}},3176:(e,t,s)=>{"use strict";s.d(t,{G:()=>i,s:()=>o});var n=s(2381),r=s(665);let a=(0,r.createContext)(void 0);function o(e){let{children:t}=e,[s,o]=(0,r.useState)(!1),[i,l]=(0,r.useState)(null),c=(0,r.useCallback)(e=>{l(e),o(!0)},[]),u=(0,r.useCallback)(()=>{o(!1),l(null)},[]);return(0,n.jsx)(a.Provider,{value:{showConfirm:c,hideConfirm:u,isOpen:s,dialogData:i},children:t})}function i(){let e=(0,r.useContext)(a);if(void 0===e)throw Error("useConfirmDialog must be used within a ConfirmDialogProvider");return e}},4191:(e,t,s)=>{"use strict";s.d(t,{Ax:()=>l,dj:()=>i,tE:()=>o});var n=s(2381),r=s(665);let a=(0,r.createContext)(void 0);function o(e){let{children:t}=e,[s,o]=(0,r.useState)([]),i=(0,r.useCallback)(e=>{let t=Math.random().toString(36).substr(2,9),s=3e3;"error"===e.type?s=5e3:"success"===e.type?s=2500:"warning"===e.type&&(s=4e3);let n={id:t,duration:void 0!==e.duration?e.duration:s,...e};console.log("Adding toast:",{type:e.type,duration:n.duration,title:e.title}),o(e=>[...e,n])},[]),l=(0,r.useCallback)(e=>{o(t=>t.filter(t=>t.id!==e))},[]),c=(0,r.useCallback)(()=>{o([])},[]);return(0,n.jsx)(a.Provider,{value:{toasts:s,addToast:i,removeToast:l,clearToasts:c},children:t})}function i(){let e=(0,r.useContext)(a);if(void 0===e)throw Error("useToast must be used within a ToastProvider");return e}function l(){let{addToast:e}=i(),t=(0,r.useCallback)((t,s,n)=>{e({type:"success",title:t,message:s,duration:n})},[e]),s=(0,r.useCallback)((t,s,n)=>{e({type:"error",title:t,message:s,duration:n})},[e]);return{showSuccess:t,showError:s,showWarning:(0,r.useCallback)((t,s,n)=>{e({type:"warning",title:t,message:s,duration:n})},[e]),showInfo:(0,r.useCallback)((t,s,n)=>{e({type:"info",title:t,message:s,duration:n})},[e])}}},4262:(e,t,s)=>{"use strict";s.d(t,{G6:()=>r,HW:()=>a,Ud:()=>o});let n="https://expense-tracker-api.opefyre.workers.dev";function r(){let e=window.open("".concat(n,"/api/auth/google"),"google-auth","width=500,height=600,scrollbars=yes,resizable=yes");if(!e)throw Error("Popup blocked by browser");return e}async function a(){let e=i("access_token"),t={"Content-Type":"application/json"};e&&(t.Authorization="Bearer ".concat(e));try{let e=await fetch("".concat(n,"/api/auth/me"),{method:"GET",headers:t,credentials:"include"});if(!e.ok){if(401===e.status)return console.log("getCurrentUser: 401 Unauthorized - no valid token"),null;let t=await e.text();return console.error("Auth check failed:",e.status,t),null}let s=await e.json();if(s.success&&s.user)return s.user;return console.error("Invalid user data received:",s),null}catch(e){return console.error("getCurrentUser error:",e),null}}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=i("access_token"),r=i("refresh_token"),a={...t.headers};a["Content-Type"]||t.body instanceof FormData||(a["Content-Type"]="application/json"),s&&(a.Authorization="Bearer ".concat(s));let o=await fetch("".concat(n).concat(e),{...t,headers:a,credentials:"include"});if(401===o.status&&r&&"/api/auth/refresh"!==e){console.log("Access token expired, attempting refresh...");try{let s=await fetch("".concat(n,"/api/auth/refresh"),{method:"POST",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},credentials:"include"});if(s.ok){let r=await s.json();console.log("Token refresh successful"),document.cookie="access_token=".concat(r.access_token,"; Secure; SameSite=None; Path=/; Max-Age=900"),document.cookie="refresh_token=".concat(r.refresh_token,"; Secure; SameSite=None; Path=/; Max-Age=604800"),a.Authorization="Bearer ".concat(r.access_token),o=await fetch("".concat(n).concat(e),{...t,headers:a,credentials:"include"}),console.log("Retry request successful:",o.status)}else console.error("Token refresh failed:",s.status),document.cookie="access_token=; Secure; SameSite=None; Path=/; Max-Age=0",document.cookie="refresh_token=; Secure; SameSite=None; Path=/; Max-Age=0",window.location.href="/"}catch(e){console.error("Token refresh failed:",e),document.cookie="access_token=; Secure; SameSite=None; Path=/; Max-Age=0",document.cookie="refresh_token=; Secure; SameSite=None; Path=/; Max-Age=0",window.location.href="/"}}return o}function i(e){let t="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===t.length){var s;return(null==(s=t.pop())?void 0:s.split(";").shift())||null}return null}},7100:()=>{},8330:(e,t,s)=>{Promise.resolve().then(s.bind(s,8394))},8394:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var n=s(2381);s(7100);var r=s(4191),a=s(1444),o=s(3176),i=s(9910);function l(){let{isLoading:e,loadingMessage:t}=(0,a.M)();return e?(0,n.jsx)("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-md z-50 flex items-center justify-center",children:(0,n.jsx)("div",{className:"bg-white/90 backdrop-blur-xl rounded-3xl p-6 shadow-2xl border border-white/20 max-w-xs mx-4",children:(0,n.jsxs)("div",{className:"flex flex-col items-center space-y-3",children:[(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"w-8 h-8 border-2 border-slate-200 rounded-full"}),(0,n.jsx)("div",{className:"absolute top-0 left-0 w-8 h-8 border-2 border-slate-600 border-t-transparent rounded-full animate-spin"})]}),(0,n.jsx)("div",{className:"text-center",children:(0,n.jsx)("p",{className:"text-sm font-medium text-slate-700",children:t})})]})})}):null}var c=s(665);let u=function(e){let{toast:t,onRemove:s}=e,[r,a]=(0,c.useState)(!1),[o,i]=(0,c.useState)(!1),l=(0,c.useRef)(s);return(0,c.useEffect)(()=>{l.current=s},[s]),(0,c.useEffect)(()=>{let e=setTimeout(()=>a(!0),10);return()=>clearTimeout(e)},[]),(0,c.useEffect)(()=>{console.log("Toast auto-dismiss setup:",{id:t.id,duration:t.duration,type:t.type});let e=t.duration||3e3;if(e>0){let s=setTimeout(()=>{console.log("Toast auto-dismissing:",t.id),i(!0),setTimeout(()=>{l.current(t.id)},300)},e);return()=>clearTimeout(s)}},[t.duration,t.id]),(0,n.jsx)("div",{className:"transform transition-all duration-300 ease-out ".concat(r&&!o?"translate-x-0 opacity-100 scale-100":"translate-x-full opacity-0 scale-95"),children:(0,n.jsx)("div",{className:"".concat((()=>{let e="rounded-xl border shadow-lg backdrop-blur-sm transition-all duration-300 ease-out";switch(t.type){case"success":return"".concat(e," bg-emerald-50 border-emerald-200 text-emerald-900");case"error":return"".concat(e," bg-red-50 border-red-200 text-red-900");case"warning":return"".concat(e," bg-amber-50 border-amber-200 text-amber-900");case"info":return"".concat(e," bg-blue-50 border-blue-200 text-blue-900");default:return"".concat(e," bg-slate-50 border-slate-200 text-slate-900")}})()," p-4 min-w-80 max-w-md"),children:(0,n.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,n.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(()=>{switch(t.type){case"success":return(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})});case"error":case"warning":return(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})});case"info":return(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}})()}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("h4",{className:"font-semibold text-sm",children:t.title}),t.message&&(0,n.jsx)("p",{className:"text-sm opacity-90 mt-1",children:t.message})]}),(0,n.jsx)("button",{onClick:()=>{i(!0),setTimeout(()=>{s(t.id)},300)},className:"flex-shrink-0 p-1 rounded-lg hover:bg-black/5 transition-colors",children:(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})})};function d(){let{toasts:e,removeToast:t}=(0,r.dj)();return 0===e.length?null:(0,n.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:e.map(e=>(0,n.jsx)(u,{toast:e,onRemove:t},e.id))})}function h(e){let{isOpen:t,title:s,message:r,confirmText:a="Confirm",cancelText:o="Cancel",type:i="danger",onConfirm:l,onCancel:u}=e,[d,h]=(0,c.useState)(!1);if((0,c.useEffect)(()=>{t&&h(!0)},[t]),!t)return null;let x=(()=>{switch(i){case"danger":return{icon:(0,n.jsx)("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),confirmButton:"bg-red-600 hover:bg-red-700 text-white"};case"warning":return{icon:(0,n.jsx)("svg",{className:"w-6 h-6 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),confirmButton:"bg-amber-600 hover:bg-amber-700 text-white"};case"info":return{icon:(0,n.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),confirmButton:"bg-blue-600 hover:bg-blue-700 text-white"}}})();return(0,n.jsx)("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,n.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 max-w-md w-full transform transition-all duration-200 ".concat(d?"scale-100 opacity-100":"scale-95 opacity-0"),children:(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:x.icon}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:s}),(0,n.jsx)("p",{className:"text-sm text-slate-600",children:r})]})]}),(0,n.jsxs)("div",{className:"flex items-center justify-end space-x-3 mt-6",children:[(0,n.jsx)("button",{onClick:()=>{h(!1),setTimeout(()=>u(),150)},className:"px-4 py-2 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors",children:o}),(0,n.jsx)("button",{onClick:()=>{h(!1),setTimeout(()=>l(),150)},className:"px-4 py-2 text-sm font-medium rounded-lg transition-colors ".concat(x.confirmButton),children:a})]})]})})})}function x(){let{isOpen:e,dialogData:t,hideConfirm:s}=(0,o.G)();return t?(0,n.jsx)(h,{isOpen:e,title:t.title,message:t.message,confirmText:t.confirmText,cancelText:t.cancelText,type:t.type,onConfirm:()=>{t.onConfirm(),s()},onCancel:s}):null}var m=s(4262);function f(e){let{children:t}=e,[s,r]=(0,c.useState)(null),[a,o]=(0,c.useState)(!0);return(0,c.useEffect)(()=>{(async()=>{try{let e=await (0,m.HW)();r(e)}catch(e){r(null)}finally{o(!1)}})()},[]),(0,n.jsx)(i.M,{user:s,children:t})}function p(e){let{children:t}=e;return(0,c.useEffect)(()=>{"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.getRegistrations().then(e=>{for(let t of e)t.unregister(),console.log("\uD83D\uDDD1️ Unregistered service worker:",t.scope);console.log("ℹ️ Service Worker disabled - PWA install still available via browser")})})},[]),(0,n.jsxs)("html",{lang:"en",children:[(0,n.jsxs)("head",{children:[(0,n.jsx)("link",{rel:"icon",href:"/icon-192x192.png?v=3",type:"image/png"}),(0,n.jsx)("link",{rel:"shortcut icon",href:"/icon-192x192.png?v=3",type:"image/png"}),(0,n.jsx)("link",{rel:"manifest",href:"/manifest.json?v=3"}),(0,n.jsx)("meta",{name:"theme-color",content:"#3b82f6"}),(0,n.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"}),(0,n.jsx)("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),(0,n.jsx)("meta",{name:"mobile-web-app-capable",content:"yes"}),(0,n.jsx)("meta",{name:"apple-mobile-web-app-status-bar-style",content:"default"}),(0,n.jsx)("meta",{name:"apple-mobile-web-app-title",content:"Expenfyre"}),(0,n.jsx)("link",{rel:"apple-touch-icon",href:"/icon-192x192.png?v=3"}),(0,n.jsx)("link",{rel:"apple-touch-icon",sizes:"192x192",href:"/icon-192x192.png?v=3"}),(0,n.jsx)("link",{rel:"apple-touch-icon",sizes:"512x512",href:"/icon-512x512.png?v=3"}),(0,n.jsx)("meta",{name:"msapplication-TileImage",content:"/icon-192x192.png?v=3"}),(0,n.jsx)("meta",{name:"msapplication-TileColor",content:"#3b82f6"}),(0,n.jsx)("title",{children:"Expenfyre - Expense Tracker"}),(0,n.jsx)("meta",{name:"description",content:"Modern expense tracking and financial management application"})]}),(0,n.jsx)("body",{children:(0,n.jsx)(r.tE,{children:(0,n.jsx)(a.o,{children:(0,n.jsx)(o.s,{children:(0,n.jsxs)(f,{children:[t,(0,n.jsx)(l,{}),(0,n.jsx)(d,{}),(0,n.jsx)(x,{})]})})})})})]})}},9910:(e,t,s)=>{"use strict";s.d(t,{E:()=>l,M:()=>i});var n=s(2381),r=s(665),a=s(4262);let o=(0,r.createContext)(void 0);function i(e){let{children:t,user:s}=e,[i,l]=(0,r.useState)([]),[c,u]=(0,r.useState)([]),[d,h]=(0,r.useState)([]),[x,m]=(0,r.useState)({expenses:!1,budgets:!1,categories:!1}),[f,p]=(0,r.useState)({expenses:null,budgets:null,categories:null}),g=async()=>{if(s){m(e=>({...e,expenses:!0}));try{let e=await (0,a.Ud)("/api/expenses");if(e.ok){let t=await e.json();l(t.data||[]),p(e=>({...e,expenses:null}))}else p(e=>({...e,expenses:"Failed to fetch expenses"}))}catch(e){p(e=>({...e,expenses:"Failed to fetch expenses"}))}finally{m(e=>({...e,expenses:!1}))}}},b=async()=>{if(s){m(e=>({...e,budgets:!0}));try{let e=await (0,a.Ud)("/api/budgets");if(e.ok){let t=await e.json();u(t.data||[]),p(e=>({...e,budgets:null}))}else p(e=>({...e,budgets:"Failed to fetch budgets"}))}catch(e){p(e=>({...e,budgets:"Failed to fetch budgets"}))}finally{m(e=>({...e,budgets:!1}))}}},v=async()=>{if(s){m(e=>({...e,categories:!0}));try{let e=await (0,a.Ud)("/api/categories");if(e.ok){let t=await e.json();h(t.data||[]),p(e=>({...e,categories:null}))}else p(e=>({...e,categories:"Failed to fetch categories"}))}catch(e){p(e=>({...e,categories:"Failed to fetch categories"}))}finally{m(e=>({...e,categories:!1}))}}};(0,r.useEffect)(()=>{s?(g(),b(),v()):(l([]),u([]),h([]))},[s]);let k=(0,r.useMemo)(()=>e=>i.filter(t=>t.month===e),[i]),j=(0,r.useMemo)(()=>e=>c.filter(t=>t.month===e),[c]),w=(0,r.useMemo)(()=>e=>d.find(t=>t.category_id===e),[d]),y=(0,r.useMemo)(()=>e=>c.find(t=>t.budget_id===e),[c]),C=async e=>{await g()},N=async(e,t)=>{await g()},S=async e=>{await g()},T=async e=>{await b()},L=async(e,t)=>{await b()},M=async e=>{await b()};return(0,n.jsx)(o.Provider,{value:{expenses:i,budgets:c,categories:d,loading:x,error:f,refetchExpenses:g,refetchBudgets:b,refetchCategories:v,invalidateCache:e=>{"all"!==e&&e&&"expenses"!==e||g(),"all"!==e&&e&&"budgets"!==e||b(),"all"!==e&&e&&"categories"!==e||v()},getExpensesByMonth:k,getBudgetsByMonth:j,getCategoryById:w,getBudgetById:y,addExpense:C,updateExpense:N,deleteExpense:S,addBudget:T,updateBudget:L,deleteBudget:M},children:t})}function l(){let e=(0,r.useContext)(o);if(void 0===e)throw Error("useData must be used within a DataProvider");return e}}},e=>{e.O(0,[587,448,621,358],()=>e(e.s=8330)),_N_E=e.O()}]);