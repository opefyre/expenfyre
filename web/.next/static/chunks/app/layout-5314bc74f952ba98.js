(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{1012:(e,t,r)=>{"use strict";r.d(t,{G:()=>i,s:()=>o});var n=r(4248),a=r(4564);let s=(0,a.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,a.useState)(!1),[i,l]=(0,a.useState)(null),c=(0,a.useCallback)(e=>{l(e),o(!0)},[]),d=(0,a.useCallback)(()=>{o(!1),l(null)},[]);return(0,n.jsx)(s.Provider,{value:{showConfirm:c,hideConfirm:d,isOpen:r,dialogData:i},children:t})}function i(){let e=(0,a.useContext)(s);if(void 0===e)throw Error("useConfirmDialog must be used within a ConfirmDialogProvider");return e}},1066:()=>{},1795:(e,t,r)=>{"use strict";r.d(t,{Ax:()=>l,dj:()=>i,tE:()=>o});var n=r(4248),a=r(4564);let s=(0,a.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,a.useState)([]),i=(0,a.useCallback)(e=>{let t=Math.random().toString(36).substr(2,9),r=3e3;"error"===e.type?r=5e3:"success"===e.type?r=2500:"warning"===e.type&&(r=4e3);let n={id:t,duration:void 0!==e.duration?e.duration:r,...e};console.log("Adding toast:",{type:e.type,duration:n.duration,title:e.title}),o(e=>[...e,n])},[]),l=(0,a.useCallback)(e=>{o(t=>t.filter(t=>t.id!==e))},[]),c=(0,a.useCallback)(()=>{o([])},[]);return(0,n.jsx)(s.Provider,{value:{toasts:r,addToast:i,removeToast:l,clearToasts:c},children:t})}function i(){let e=(0,a.useContext)(s);if(void 0===e)throw Error("useToast must be used within a ToastProvider");return e}function l(){let{addToast:e}=i(),t=(0,a.useCallback)((t,r,n)=>{e({type:"success",title:t,message:r,duration:n})},[e]),r=(0,a.useCallback)((t,r,n)=>{e({type:"error",title:t,message:r,duration:n})},[e]);return{showSuccess:t,showError:r,showWarning:(0,a.useCallback)((t,r,n)=>{e({type:"warning",title:t,message:r,duration:n})},[e]),showInfo:(0,a.useCallback)((t,r,n)=>{e({type:"info",title:t,message:r,duration:n})},[e])}}},2536:(e,t,r)=>{"use strict";r.d(t,{M:()=>i,o:()=>o});var n=r(4248),a=r(4564);let s=(0,a.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,a.useState)(!1),[i,l]=(0,a.useState)("Loading..."),c=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Loading...";o(e),l(t)},[]),d=(0,a.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Loading...";c(!0,e)},[c]),u=(0,a.useCallback)(()=>{c(!1)},[c]);return(0,n.jsx)(s.Provider,{value:{isLoading:r,loadingMessage:i,setLoading:c,showLoading:d,hideLoading:u},children:t})}function i(){let e=(0,a.useContext)(s);if(void 0===e)throw Error("useLoading must be used within a LoadingProvider");return e}},3172:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var n=r(4248);r(1066);var a=r(1795),s=r(2536),o=r(1012),i=r(7143);function l(){let{isLoading:e,loadingMessage:t}=(0,s.M)();return e?(0,n.jsx)("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-md z-50 flex items-center justify-center",children:(0,n.jsx)("div",{className:"bg-white/90 backdrop-blur-xl rounded-3xl p-6 shadow-2xl border border-white/20 max-w-xs mx-4",children:(0,n.jsxs)("div",{className:"flex flex-col items-center space-y-3",children:[(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"w-8 h-8 border-2 border-slate-200 rounded-full"}),(0,n.jsx)("div",{className:"absolute top-0 left-0 w-8 h-8 border-2 border-slate-600 border-t-transparent rounded-full animate-spin"})]}),(0,n.jsx)("div",{className:"text-center",children:(0,n.jsx)("p",{className:"text-sm font-medium text-slate-700",children:t})})]})})}):null}var c=r(4564);let d=function(e){let{toast:t,onRemove:r}=e,[a,s]=(0,c.useState)(!1),[o,i]=(0,c.useState)(!1),l=(0,c.useRef)(r);return(0,c.useEffect)(()=>{l.current=r},[r]),(0,c.useEffect)(()=>{let e=setTimeout(()=>s(!0),10);return()=>clearTimeout(e)},[]),(0,c.useEffect)(()=>{console.log("Toast auto-dismiss setup:",{id:t.id,duration:t.duration,type:t.type});let e=t.duration||3e3;if(e>0){let r=setTimeout(()=>{console.log("Toast auto-dismissing:",t.id),i(!0),setTimeout(()=>{l.current(t.id)},300)},e);return()=>clearTimeout(r)}},[t.duration,t.id]),(0,n.jsx)("div",{className:"transform transition-all duration-300 ease-out ".concat(a&&!o?"translate-x-0 opacity-100 scale-100":"translate-x-full opacity-0 scale-95"),children:(0,n.jsx)("div",{className:"".concat((()=>{let e="rounded-xl border shadow-lg backdrop-blur-sm transition-all duration-300 ease-out";switch(t.type){case"success":return"".concat(e," bg-emerald-50 border-emerald-200 text-emerald-900");case"error":return"".concat(e," bg-red-50 border-red-200 text-red-900");case"warning":return"".concat(e," bg-amber-50 border-amber-200 text-amber-900");case"info":return"".concat(e," bg-blue-50 border-blue-200 text-blue-900");default:return"".concat(e," bg-slate-50 border-slate-200 text-slate-900")}})()," p-4 min-w-80 max-w-md"),children:(0,n.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,n.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(()=>{switch(t.type){case"success":return(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})});case"error":case"warning":return(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})});case"info":return(0,n.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}})()}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("h4",{className:"font-semibold text-sm",children:t.title}),t.message&&(0,n.jsx)("p",{className:"text-sm opacity-90 mt-1",children:t.message})]}),(0,n.jsx)("button",{onClick:()=>{i(!0),setTimeout(()=>{r(t.id)},300)},className:"flex-shrink-0 p-1 rounded-lg hover:bg-black/5 transition-colors",children:(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})})};function u(){let{toasts:e,removeToast:t}=(0,a.dj)();return 0===e.length?null:(0,n.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:e.map(e=>(0,n.jsx)(d,{toast:e,onRemove:t},e.id))})}function h(e){let{isOpen:t,title:r,message:a,confirmText:s="Confirm",cancelText:o="Cancel",type:i="danger",onConfirm:l,onCancel:d}=e,[u,h]=(0,c.useState)(!1);if((0,c.useEffect)(()=>{t&&h(!0)},[t]),!t)return null;let m=(()=>{switch(i){case"danger":return{icon:(0,n.jsx)("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),confirmButton:"bg-red-600 hover:bg-red-700 text-white"};case"warning":return{icon:(0,n.jsx)("svg",{className:"w-6 h-6 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),confirmButton:"bg-amber-600 hover:bg-amber-700 text-white"};case"info":return{icon:(0,n.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),confirmButton:"bg-blue-600 hover:bg-blue-700 text-white"}}})();return(0,n.jsx)("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,n.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 max-w-md w-full transform transition-all duration-200 ".concat(u?"scale-100 opacity-100":"scale-95 opacity-0"),children:(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:m.icon}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:r}),(0,n.jsx)("p",{className:"text-sm text-slate-600",children:a})]})]}),(0,n.jsxs)("div",{className:"flex items-center justify-end space-x-3 mt-6",children:[(0,n.jsx)("button",{onClick:()=>{h(!1),setTimeout(()=>d(),150)},className:"px-4 py-2 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors",children:o}),(0,n.jsx)("button",{onClick:()=>{h(!1),setTimeout(()=>l(),150)},className:"px-4 py-2 text-sm font-medium rounded-lg transition-colors ".concat(m.confirmButton),children:s})]})]})})})}function m(){let{isOpen:e,dialogData:t,hideConfirm:r}=(0,o.G)();return t?(0,n.jsx)(h,{isOpen:e,title:t.title,message:t.message,confirmText:t.confirmText,cancelText:t.cancelText,type:t.type,onConfirm:()=>{t.onConfirm(),r()},onCancel:r}):null}var f=r(4650);function x(e){let{children:t}=e,[r,a]=(0,c.useState)(null),[s,o]=(0,c.useState)(!0);return(0,c.useEffect)(()=>{(async()=>{try{let e=await (0,f.HW)();a(e)}catch(e){a(null)}finally{o(!1)}})()},[]),(0,n.jsx)(i.M,{user:r,children:t})}function p(e){let{children:t}=e;return(0,c.useEffect)(()=>{"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.getRegistrations().then(e=>{for(let t of e)t.unregister(),console.log("\uD83D\uDDD1️ Unregistered service worker:",t.scope);console.log("ℹ️ Service Worker disabled - PWA install still available via browser")})})},[]),(0,n.jsxs)("html",{lang:"en",children:[(0,n.jsxs)("head",{children:[(0,n.jsx)("link",{rel:"icon",href:"/icon-192x192.png?v=3",type:"image/png"}),(0,n.jsx)("link",{rel:"shortcut icon",href:"/icon-192x192.png?v=3",type:"image/png"}),(0,n.jsx)("link",{rel:"manifest",href:"/manifest.json?v=3"}),(0,n.jsx)("meta",{name:"theme-color",content:"#3b82f6"}),(0,n.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"}),(0,n.jsx)("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),(0,n.jsx)("meta",{name:"mobile-web-app-capable",content:"yes"}),(0,n.jsx)("meta",{name:"apple-mobile-web-app-status-bar-style",content:"default"}),(0,n.jsx)("meta",{name:"apple-mobile-web-app-title",content:"Expenfyre"}),(0,n.jsx)("link",{rel:"apple-touch-icon",href:"/icon-192x192.png?v=3"}),(0,n.jsx)("link",{rel:"apple-touch-icon",sizes:"192x192",href:"/icon-192x192.png?v=3"}),(0,n.jsx)("link",{rel:"apple-touch-icon",sizes:"512x512",href:"/icon-512x512.png?v=3"}),(0,n.jsx)("meta",{name:"msapplication-TileImage",content:"/icon-192x192.png?v=3"}),(0,n.jsx)("meta",{name:"msapplication-TileColor",content:"#3b82f6"}),(0,n.jsx)("title",{children:"Expenfyre - Expense Tracker"}),(0,n.jsx)("meta",{name:"description",content:"Modern expense tracking and financial management application"})]}),(0,n.jsx)("body",{children:(0,n.jsx)(a.tE,{children:(0,n.jsx)(s.o,{children:(0,n.jsx)(o.s,{children:(0,n.jsxs)(x,{children:[t,(0,n.jsx)(l,{}),(0,n.jsx)(u,{}),(0,n.jsx)(m,{})]})})})})})]})}},4650:(e,t,r)=>{"use strict";r.d(t,{G6:()=>a,HW:()=>s,Ud:()=>o});let n="https://expense-tracker-api.opefyre.workers.dev";function a(){let e=window.open("".concat(n,"/api/auth/google"),"google-auth","width=500,height=600,scrollbars=yes,resizable=yes");if(!e)throw Error("Popup blocked by browser");return e}async function s(){let e=i("access_token"),t={"Content-Type":"application/json"};e&&(t.Authorization="Bearer ".concat(e));try{let e=await fetch("".concat(n,"/api/auth/me"),{method:"GET",headers:t,credentials:"include"});if(!e.ok){if(401===e.status)return console.log("getCurrentUser: 401 Unauthorized - no valid token"),null;let t=await e.text();return console.error("Auth check failed:",e.status,t),null}let r=await e.json();if(r.success&&r.user)return r.user;return console.error("Invalid user data received:",r),null}catch(e){return console.error("getCurrentUser error:",e),null}}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i("access_token"),a=i("refresh_token"),s={...t.headers};s["Content-Type"]||t.body instanceof FormData||(s["Content-Type"]="application/json"),r&&(s.Authorization="Bearer ".concat(r));let o=await fetch("".concat(n).concat(e),{...t,headers:s,credentials:"include"});if(401===o.status&&a&&"/api/auth/refresh"!==e){console.log("Access token expired, attempting refresh...");try{let r=await fetch("".concat(n,"/api/auth/refresh"),{method:"POST",headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},credentials:"include"});if(r.ok){let a=await r.json();console.log("Token refresh successful"),document.cookie="access_token=".concat(a.access_token,"; Secure; SameSite=None; Path=/; Max-Age=900"),document.cookie="refresh_token=".concat(a.refresh_token,"; Secure; SameSite=None; Path=/; Max-Age=604800"),s.Authorization="Bearer ".concat(a.access_token),o=await fetch("".concat(n).concat(e),{...t,headers:s,credentials:"include"}),console.log("Retry request successful:",o.status)}else console.error("Token refresh failed:",r.status),document.cookie="access_token=; Secure; SameSite=None; Path=/; Max-Age=0",document.cookie="refresh_token=; Secure; SameSite=None; Path=/; Max-Age=0",window.location.href="/"}catch(e){console.error("Token refresh failed:",e),document.cookie="access_token=; Secure; SameSite=None; Path=/; Max-Age=0",document.cookie="refresh_token=; Secure; SameSite=None; Path=/; Max-Age=0",window.location.href="/"}}return o}function i(e){let t="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===t.length){var r;return(null==(r=t.pop())?void 0:r.split(";").shift())||null}return null}},7143:(e,t,r)=>{"use strict";r.d(t,{M:()=>m,E:()=>f});var n=r(4248),a=r(4564),s=r(4650);let o=new Map,i=new Map,l={enabled:!0,staleTime:3e5,cacheTime:6e5,retry:!0,retryDelay:1e3,maxRetries:3},c=e=>new Promise(t=>setTimeout(t,e));function d(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n={...l,...r},[s,d]=(0,a.useState)({data:null,loading:!1,error:null,lastFetched:null}),u=(0,a.useRef)(!0),h=(0,a.useRef)(0);(0,a.useEffect)(()=>()=>{u.current=!1},[]);let m=(0,a.useCallback)(async function(){let t,r,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!n.enabled)return null;let s=o.get(e);if(!a&&s&&(t=s.timestamp,r=n.staleTime,!(Date.now()-t>r)))return u.current&&d(e=>({...e,data:s.data,error:null,lastFetched:s.timestamp})),s.data;let l=i.get(e);if(l)try{return await l}catch(e){throw e}"".concat(e,"-").concat(++h.current);let c=f();i.set(e,c);try{let t=await c;return o.set(e,{data:t,timestamp:Date.now()}),u.current&&d({data:t,loading:!1,error:null,lastFetched:Date.now()}),t}catch(e){throw u.current&&d(t=>({...t,loading:!1,error:e instanceof Error?e.message:"Unknown error"})),e}finally{i.delete(e)}},[e,t,n.enabled,n.staleTime]),f=async()=>{let e;for(let r=0;r<=n.maxRetries;r++)try{return u.current&&d(e=>({...e,loading:!0,error:null})),await t()}catch(t){if(e=t instanceof Error?t:Error("Unknown error"),r===n.maxRetries)throw e;await c(n.retryDelay*Math.pow(2,r))}throw e};return(0,a.useEffect)(()=>{n.enabled&&m()},[e,n.enabled]),(0,a.useEffect)(()=>{let e=setInterval(()=>{let e=Date.now();for(let[t,r]of o.entries())e-r.timestamp>n.cacheTime&&o.delete(t)},6e4);return()=>clearInterval(e)},[n.cacheTime]),{...s,refetch:()=>m(!0),invalidate:()=>{o.delete(e),i.delete(e)}}}let u={clear:()=>{o.clear(),i.clear()},clearByPattern:e=>{for(let t of o.keys())t.includes(e)&&(o.delete(t),i.delete(t))}},h=(0,a.createContext)(void 0);function m(e){let{children:t,user:r}=e,o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d("expenses-".concat(JSON.stringify(e||{})),async()=>{let t=new URLSearchParams;e&&Object.entries(e).forEach(e=>{let[r,n]=e;null!=n&&""!==n&&t.append(r,String(n))}),t.append("limit","100");let r=await (0,s.Ud)("/api/expenses?".concat(t.toString()));if(!r.ok)throw Error("Failed to fetch expenses: ".concat(r.status));let n=await r.json();if(!n.success)throw Error(n.error||"Failed to fetch expenses");return n.data||[]},{staleTime:12e4,cacheTime:3e5,...t})}({},{enabled:!!r}),i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d("budgets-".concat(JSON.stringify(e||{})),async()=>{let t=new URLSearchParams;e&&Object.entries(e).forEach(e=>{let[r,n]=e;null!=n&&""!==n&&t.append(r,String(n))});let r=await (0,s.Ud)("/api/budgets?".concat(t.toString()));if(!r.ok)throw Error("Failed to fetch budgets: ".concat(r.status));let n=await r.json();if(!n.success)throw Error(n.error||"Failed to fetch budgets");return n.data||[]},{staleTime:3e5,cacheTime:6e5,...t})}({},{enabled:!!r}),l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return d("categories",async()=>{let e=await (0,s.Ud)("/api/categories");if(!e.ok)throw Error("Failed to fetch categories: ".concat(e.status));let t=await e.json();if(!t.success)throw Error(t.error||"Failed to fetch categories");return t.data||[]},{staleTime:6e5,cacheTime:18e5,...e})}({enabled:!!r}),c=(0,a.useMemo)(()=>e=>{var t;return(null==(t=o.data)?void 0:t.filter(t=>t.month===e))||[]},[o.data]),m=(0,a.useMemo)(()=>e=>{var t;return(null==(t=i.data)?void 0:t.filter(t=>t.month===e))||[]},[i.data]),f=(0,a.useMemo)(()=>e=>{var t;return null==(t=l.data)?void 0:t.find(t=>t.category_id===e)},[l.data]),x=(0,a.useMemo)(()=>e=>{var t;return null==(t=i.data)?void 0:t.find(t=>t.budget_id===e)},[i.data]),p=e=>{"all"!==e&&e?u.clearByPattern(e):u.clear()},g=async e=>{p("expenses"),await o.refetch()},b=async(e,t)=>{p("expenses"),await o.refetch()},v=async e=>{p("expenses"),await o.refetch()},w=async e=>{p("budgets"),await i.refetch()},k=async(e,t)=>{p("budgets"),await i.refetch()},j=async e=>{p("budgets"),await i.refetch()},y={expenses:o.data||[],budgets:i.data||[],categories:l.data||[],loading:{expenses:o.loading,budgets:i.loading,categories:l.loading},error:{expenses:o.error,budgets:i.error,categories:l.error},refetchExpenses:o.refetch,refetchBudgets:i.refetch,refetchCategories:l.refetch,invalidateCache:p,getExpensesByMonth:c,getBudgetsByMonth:m,getCategoryById:f,getBudgetById:x,addExpense:g,updateExpense:b,deleteExpense:v,addBudget:w,updateBudget:k,deleteBudget:j};return(0,n.jsx)(h.Provider,{value:y,children:t})}function f(){let e=(0,a.useContext)(h);if(void 0===e)throw Error("useData must be used within a DataProvider");return e}},9659:(e,t,r)=>{Promise.resolve().then(r.bind(r,3172))}},e=>{e.O(0,[377,647,516,358],()=>e(e.s=9659)),_N_E=e.O()}]);