(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[745],{140:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var a=s(4248),n=s(4564),r=s(4650),o=s(1302),l=s(2536),i=s(1795),c=s(2703),d=s(3439),x=s(5881),m=s(6966),h=s(1969),u=s(309),g=s(5828),f=s(4085),b=s(9332),p=s(8919),j=s(1786);function y(){let[e,t]=(0,n.useState)(null),[s,y]=(0,n.useState)([]),[N,v]=(0,n.useState)(null),[w,k]=(0,n.useState)([]),[S,_]=(0,n.useState)([]),[M,z]=(0,n.useState)([]),{showLoading:P,hideLoading:L}=(0,l.M)(),{showSuccess:W,showError:U}=(0,i.Ax)();(0,n.useEffect)(()=>{A()},[]),(0,n.useEffect)(()=>{if(e){let e=setTimeout(()=>{B()},200);return()=>clearTimeout(e)}},[e]);let A=async()=>{P("Checking authentication...");try{let e=await (0,r.HW)();e?t(e):window.location.href="/"}catch(e){console.error("Auth check failed:",e),window.location.href="/"}finally{L()}},B=async()=>{try{P("Loading analytics...");let e=new URLSearchParams,[t,s,a,n,o]=await Promise.all([(0,r.Ud)("/api/analytics/summary?".concat(e.toString())),(0,r.Ud)("/api/categories"),(0,r.Ud)("/api/analytics/category-breakdown?".concat(e.toString())),(0,r.Ud)("/api/analytics/monthly-comparison?months=12"),(0,r.Ud)("/api/analytics/budget-performance?month=".concat(new Date().toISOString().substring(0,7)))]),[l,i,c,d,x]=await Promise.all([t.json(),s.json(),a.json(),n.json(),o.json()]);l.success&&v(l.data),i.success&&y(i.data),c.success&&k(c.data),d.success&&_(d.data),x.success&&z(x.data)}catch(e){console.error("Error loading analytics:",e),U("Failed to load analytics","Please try again later")}finally{L()}},C=async()=>{try{P("Signing out..."),await (0,r.Ud)("/api/auth/signout",{method:"POST"}),document.cookie="access_token=; Secure; SameSite=None; Path=/; Max-Age=0",document.cookie="refresh_token=; Secure; SameSite=None; Path=/; Max-Age=0",t(null),W("Signed out successfully!"),window.location.href="/"}catch(e){console.error("Sign out error:",e),U("Sign out failed","Please try again."),document.cookie="access_token=; Secure; SameSite=None; Path=/; Max-Age=0",document.cookie="refresh_token=; Secure; SameSite=None; Path=/; Max-Age=0",window.location.href="/"}finally{L()}},E=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EUR"}).format(e),F=e=>{let[t,s]=e.split("-");return new Date(parseInt(t),parseInt(s)-1).toLocaleDateString("en-US",{year:"numeric",month:"short"})},O=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#84cc16","#f97316","#ec4899","#6366f1"];return e?(0,a.jsx)(o.A,{user:e,currentPage:"/analytics",onSignOut:C,children:(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsx)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 flex-shrink-0",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-900",children:"Analytics"}),(0,a.jsx)("p",{className:"text-sm text-slate-500 mt-1",children:"Key insights and trends for your expenses"})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto overflow-x-hidden w-full",children:(0,a.jsxs)("div",{className:"space-y-6 w-full max-w-full",children:[N&&(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-5 text-white",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm opacity-90",children:"Total Spent"}),(0,a.jsx)("svg",{className:"w-5 h-5 opacity-80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})]}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:E(N.total_expenses)}),(0,a.jsxs)("p",{className:"text-xs opacity-75 mt-1",children:[N.expense_count," transactions"]})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-5 text-white",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm opacity-90",children:"Total Budget"}),(0,a.jsx)("svg",{className:"w-5 h-5 opacity-80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})]}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:E(N.total_budget)}),(0,a.jsxs)("p",{className:"text-xs opacity-75 mt-1",children:[N.budget_count," budgets"]})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-amber-500 to-amber-600 rounded-xl p-5 text-white",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm opacity-90",children:"Avg. Expense"}),(0,a.jsx)("svg",{className:"w-5 h-5 opacity-80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})]}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:E(N.average_expense)}),(0,a.jsx)("p",{className:"text-xs opacity-75 mt-1",children:"per transaction"})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-br rounded-xl p-5 ".concat(N.budget_utilization>100?"from-red-500 to-red-600 text-white":N.budget_utilization>80?"from-orange-500 to-orange-600 text-white":"from-emerald-500 to-emerald-600 text-white"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Budget Usage"}),(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})]}),(0,a.jsxs)("p",{className:"text-3xl font-bold",children:[N.budget_utilization.toFixed(1),"%"]}),(0,a.jsx)("p",{className:"text-xs mt-1 opacity-90",children:N.budget_utilization>100?"Over budget!":N.budget_utilization>80?"Near limit":"On track"})]})]}),S.length>0&&(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-slate-200 p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Monthly Overview"}),(0,a.jsx)(c.u,{width:"100%",height:300,children:(0,a.jsxs)(d.b,{data:S,children:[(0,a.jsx)(x.d,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),(0,a.jsx)(m.W,{dataKey:"month",tick:{fontSize:12},tickFormatter:F}),(0,a.jsx)(h.h,{tick:{fontSize:12}}),(0,a.jsx)(u.m,{formatter:e=>E(e),labelFormatter:F}),(0,a.jsx)(g.s,{}),(0,a.jsx)(f.N,{type:"monotone",dataKey:"total_expenses",name:"Expenses",stroke:"#ef4444",strokeWidth:3,dot:{fill:"#ef4444",strokeWidth:2,r:4},activeDot:{r:6,stroke:"#ef4444",strokeWidth:2}}),(0,a.jsx)(f.N,{type:"monotone",dataKey:"total_budget",name:"Budget",stroke:"#10b981",strokeWidth:3,dot:{fill:"#10b981",strokeWidth:2,r:4},activeDot:{r:6,stroke:"#10b981",strokeWidth:2}})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[w.length>0&&(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-slate-200 p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Spending by Category"}),(0,a.jsx)(c.u,{width:"100%",height:300,children:(0,a.jsxs)(b.r,{children:[(0,a.jsx)(p.F,{data:w,dataKey:"total_amount",nameKey:"category_name",cx:"50%",cy:"50%",outerRadius:80,innerRadius:30,label:e=>{let{category_name:t,percentage:s}=e;return s>5?"".concat(t,": ").concat(s.toFixed(1),"%"):""},labelLine:!1,children:w.map((e,t)=>(0,a.jsx)(j.f,{fill:O[t%O.length]},"cell-".concat(t)))}),(0,a.jsx)(u.m,{formatter:(e,t,s)=>[E(e),"".concat(s.payload.category_name," (").concat(s.payload.percentage.toFixed(1),"%)")],labelStyle:{color:"#374151"},contentStyle:{backgroundColor:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"8px"}})]})})]}),M.length>0&&(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-slate-200 p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Budget Performance"}),(0,a.jsx)("div",{className:"space-y-3 max-h-[300px] overflow-y-auto",children:M.map((e,t)=>(0,a.jsxs)("div",{className:"border border-slate-100 rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-700",children:e.category_name}),(0,a.jsxs)("span",{className:"text-xs px-2 py-1 rounded-full ".concat("over"===e.status?"bg-red-100 text-red-700":"near"===e.status?"bg-orange-100 text-orange-700":"bg-green-100 text-green-700"),children:[e.utilization_percentage.toFixed(0),"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-slate-100 rounded-full h-2 mb-2",children:(0,a.jsx)("div",{className:"h-2 rounded-full ".concat("over"===e.status?"bg-red-500":"near"===e.status?"bg-orange-500":"bg-green-500"),style:{width:"".concat(Math.min(e.utilization_percentage,100),"%")}})}),(0,a.jsxs)("div",{className:"flex justify-between text-xs text-slate-500",children:[(0,a.jsxs)("span",{children:["Spent: ",E(e.spent_amount)]}),(0,a.jsxs)("span",{children:["Budget: ",E(e.budget_amount)]})]})]},t))})]})]})]})})]})}):null}},6633:(e,t,s)=>{Promise.resolve().then(s.bind(s,140))}},e=>{e.O(0,[433,916,647,516,358],()=>e(e.s=6633)),_N_E=e.O()}]);