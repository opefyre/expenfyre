(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{1444:(e,t,r)=>{"use strict";r.d(t,{M:()=>i,o:()=>o});var s=r(2381),n=r(665);let a=(0,n.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,n.useState)(!1),[i,l]=(0,n.useState)("Loading..."),c=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Loading...";o(e),l(t)},[]),d=(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Loading...";c(!0,e)},[c]),u=(0,n.useCallback)(()=>{c(!1)},[c]);return(0,s.jsx)(a.Provider,{value:{isLoading:r,loadingMessage:i,setLoading:c,showLoading:d,hideLoading:u},children:t})}function i(){let e=(0,n.useContext)(a);if(void 0===e)throw Error("useLoading must be used within a LoadingProvider");return e}},3013:(e,t,r)=>{"use strict";r.d(t,{D:()=>i,N:()=>o});var s=r(2381),n=r(665);let a=(0,n.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,n.useState)("light"),[i,l]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{let e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";o(e||t),l(!0)},[]),(0,n.useEffect)(()=>{if(i){let e=document.documentElement;"dark"===r?e.classList.add("dark"):e.classList.remove("dark"),localStorage.setItem("theme",r);let t=document.querySelector('meta[name="theme-color"]');t&&t.setAttribute("content","dark"===r?"#1f2937":"#3b82f6")}},[r,i]),i)?(0,s.jsx)(a.Provider,{value:{theme:r,toggleTheme:()=>{o(e=>"light"===e?"dark":"light")},setTheme:e=>{o(e)}},children:t}):null}function i(){let e=(0,n.useContext)(a);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},3176:(e,t,r)=>{"use strict";r.d(t,{G:()=>i,s:()=>o});var s=r(2381),n=r(665);let a=(0,n.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,n.useState)(!1),[i,l]=(0,n.useState)(null),c=(0,n.useCallback)(e=>{l(e),o(!0)},[]),d=(0,n.useCallback)(()=>{o(!1),l(null)},[]);return(0,s.jsx)(a.Provider,{value:{showConfirm:c,hideConfirm:d,isOpen:r,dialogData:i},children:t})}function i(){let e=(0,n.useContext)(a);if(void 0===e)throw Error("useConfirmDialog must be used within a ConfirmDialogProvider");return e}},4191:(e,t,r)=>{"use strict";r.d(t,{Ax:()=>l,dj:()=>i,tE:()=>o});var s=r(2381),n=r(665);let a=(0,n.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,n.useState)([]),i=(0,n.useCallback)(e=>{let t=Math.random().toString(36).substr(2,9),r=3e3;"error"===e.type?r=5e3:"success"===e.type?r=2500:"warning"===e.type&&(r=4e3);let s={id:t,duration:void 0!==e.duration?e.duration:r,...e};console.log("Adding toast:",{type:e.type,duration:s.duration,title:e.title}),o(e=>[...e,s])},[]),l=(0,n.useCallback)(e=>{o(t=>t.filter(t=>t.id!==e))},[]),c=(0,n.useCallback)(()=>{o([])},[]);return(0,s.jsx)(a.Provider,{value:{toasts:r,addToast:i,removeToast:l,clearToasts:c},children:t})}function i(){let e=(0,n.useContext)(a);if(void 0===e)throw Error("useToast must be used within a ToastProvider");return e}function l(){let{addToast:e}=i(),t=(0,n.useCallback)((t,r,s)=>{e({type:"success",title:t,message:r,duration:s})},[e]),r=(0,n.useCallback)((t,r,s)=>{e({type:"error",title:t,message:r,duration:s})},[e]);return{showSuccess:t,showError:r,showWarning:(0,n.useCallback)((t,r,s)=>{e({type:"warning",title:t,message:r,duration:s})},[e]),showInfo:(0,n.useCallback)((t,r,s)=>{e({type:"info",title:t,message:r,duration:s})},[e])}}},4262:(e,t,r)=>{"use strict";r.d(t,{G6:()=>n,HW:()=>a,Ud:()=>o});let s="https://expense-tracker-api.opefyre.workers.dev";function n(){let e=window.open("".concat(s,"/api/auth/google"),"google-auth","width=500,height=600,scrollbars=yes,resizable=yes");if(!e)throw Error("Popup blocked by browser");return e}async function a(){let e=i("access_token"),t={"Content-Type":"application/json"};e&&(t.Authorization="Bearer ".concat(e));try{let e=await fetch("".concat(s,"/api/auth/me"),{method:"GET",headers:t,credentials:"include"});if(!e.ok){if(401===e.status)return console.log("getCurrentUser: 401 Unauthorized - no valid token"),null;let t=await e.text();return console.error("Auth check failed:",e.status,t),null}let r=await e.json();if(r.success&&r.user)return r.user;return console.error("Invalid user data received:",r),null}catch(e){return console.error("getCurrentUser error:",e),null}}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i("access_token"),n=i("refresh_token"),a={...t.headers};a["Content-Type"]||t.body instanceof FormData||(a["Content-Type"]="application/json"),r&&(a.Authorization="Bearer ".concat(r));let o=await fetch("".concat(s).concat(e),{...t,headers:a,credentials:"include"});if(401===o.status&&n&&"/api/auth/refresh"!==e){console.log("Access token expired, attempting refresh...");try{let r=await fetch("".concat(s,"/api/auth/refresh"),{method:"POST",headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"},credentials:"include"});if(r.ok){let n=await r.json();console.log("Token refresh successful"),document.cookie="access_token=".concat(n.access_token,"; Secure; SameSite=None; Path=/; Max-Age=900"),document.cookie="refresh_token=".concat(n.refresh_token,"; Secure; SameSite=None; Path=/; Max-Age=604800"),a.Authorization="Bearer ".concat(n.access_token),o=await fetch("".concat(s).concat(e),{...t,headers:a,credentials:"include"}),console.log("Retry request successful:",o.status)}else console.error("Token refresh failed:",r.status),document.cookie="access_token=; Secure; SameSite=None; Path=/; Max-Age=0",document.cookie="refresh_token=; Secure; SameSite=None; Path=/; Max-Age=0",window.location.href="/"}catch(e){console.error("Token refresh failed:",e),document.cookie="access_token=; Secure; SameSite=None; Path=/; Max-Age=0",document.cookie="refresh_token=; Secure; SameSite=None; Path=/; Max-Age=0",window.location.href="/"}}return o}function i(e){let t="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===t.length){var r;return(null==(r=t.pop())?void 0:r.split(";").shift())||null}return null}},7100:()=>{},8330:(e,t,r)=>{Promise.resolve().then(r.bind(r,8394))},8394:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var s=r(2381);r(7100);var n=r(4191),a=r(1444),o=r(3176),i=r(9910),l=r(3013);function c(){let{isLoading:e,loadingMessage:t}=(0,a.M)();return e?(0,s.jsx)("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-md z-50 flex items-center justify-center",children:(0,s.jsx)("div",{className:"bg-white/90 backdrop-blur-xl rounded-3xl p-6 shadow-2xl border border-white/20 max-w-xs mx-4",children:(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-3",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"w-8 h-8 border-2 border-slate-200 rounded-full"}),(0,s.jsx)("div",{className:"absolute top-0 left-0 w-8 h-8 border-2 border-slate-600 border-t-transparent rounded-full animate-spin"})]}),(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("p",{className:"text-sm font-medium text-slate-700",children:t})})]})})}):null}var d=r(665);let u=function(e){let{toast:t,onRemove:r}=e,[n,a]=(0,d.useState)(!1),[o,i]=(0,d.useState)(!1),l=(0,d.useRef)(r);return(0,d.useEffect)(()=>{l.current=r},[r]),(0,d.useEffect)(()=>{let e=setTimeout(()=>a(!0),10);return()=>clearTimeout(e)},[]),(0,d.useEffect)(()=>{console.log("Toast auto-dismiss setup:",{id:t.id,duration:t.duration,type:t.type});let e=t.duration||3e3;if(e>0){let r=setTimeout(()=>{console.log("Toast auto-dismissing:",t.id),i(!0),setTimeout(()=>{l.current(t.id)},300)},e);return()=>clearTimeout(r)}},[t.duration,t.id]),(0,s.jsx)("div",{className:"transform transition-all duration-300 ease-out ".concat(n&&!o?"translate-x-0 opacity-100 scale-100":"translate-x-full opacity-0 scale-95"),children:(0,s.jsx)("div",{className:"".concat((()=>{let e="rounded-xl border shadow-lg backdrop-blur-sm transition-all duration-300 ease-out";switch(t.type){case"success":return"".concat(e," bg-emerald-50 border-emerald-200 text-emerald-900");case"error":return"".concat(e," bg-red-50 border-red-200 text-red-900");case"warning":return"".concat(e," bg-amber-50 border-amber-200 text-amber-900");case"info":return"".concat(e," bg-blue-50 border-blue-200 text-blue-900");default:return"".concat(e," bg-slate-50 border-slate-200 text-slate-900")}})()," p-4 min-w-80 max-w-md"),children:(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(()=>{switch(t.type){case"success":return(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})});case"error":case"warning":return(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})});case"info":return(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}})()}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("h4",{className:"font-semibold text-sm",children:t.title}),t.message&&(0,s.jsx)("p",{className:"text-sm opacity-90 mt-1",children:t.message})]}),(0,s.jsx)("button",{onClick:()=>{i(!0),setTimeout(()=>{r(t.id)},300)},className:"flex-shrink-0 p-1 rounded-lg hover:bg-black/5 transition-colors",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})})};function h(){let{toasts:e,removeToast:t}=(0,n.dj)();return 0===e.length?null:(0,s.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:e.map(e=>(0,s.jsx)(u,{toast:e,onRemove:t},e.id))})}function m(e){let{isOpen:t,title:r,message:n,confirmText:a="Confirm",cancelText:o="Cancel",type:i="danger",onConfirm:l,onCancel:c}=e,[u,h]=(0,d.useState)(!1);if((0,d.useEffect)(()=>{t&&h(!0)},[t]),!t)return null;let m=(()=>{switch(i){case"danger":return{icon:(0,s.jsx)("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),confirmButton:"bg-red-600 hover:bg-red-700 text-white"};case"warning":return{icon:(0,s.jsx)("svg",{className:"w-6 h-6 text-amber-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),confirmButton:"bg-amber-600 hover:bg-amber-700 text-white"};case"info":return{icon:(0,s.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),confirmButton:"bg-blue-600 hover:bg-blue-700 text-white"}}})();return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,s.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl border border-slate-200 max-w-md w-full transform transition-all duration-200 ".concat(u?"scale-100 opacity-100":"scale-95 opacity-0"),children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:m.icon}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:r}),(0,s.jsx)("p",{className:"text-sm text-slate-600",children:n})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-end space-x-3 mt-6",children:[(0,s.jsx)("button",{onClick:()=>{h(!1),setTimeout(()=>c(),150)},className:"px-4 py-2 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors",children:o}),(0,s.jsx)("button",{onClick:()=>{h(!1),setTimeout(()=>l(),150)},className:"px-4 py-2 text-sm font-medium rounded-lg transition-colors ".concat(m.confirmButton),children:a})]})]})})})}function x(){let{isOpen:e,dialogData:t,hideConfirm:r}=(0,o.G)();return t?(0,s.jsx)(m,{isOpen:e,title:t.title,message:t.message,confirmText:t.confirmText,cancelText:t.cancelText,type:t.type,onConfirm:()=>{t.onConfirm(),r()},onCancel:r}):null}var f=r(4262);function p(e){let{children:t}=e,[r,n]=(0,d.useState)(null),[a,o]=(0,d.useState)(!0);return(0,d.useEffect)(()=>{(async()=>{try{let e=await (0,f.HW)();n(e)}catch(e){n(null)}finally{o(!1)}})()},[]),(0,s.jsx)(i.M,{user:r,children:t})}function g(e){let{children:t}=e;return(0,d.useEffect)(()=>{"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.getRegistrations().then(e=>{for(let t of e)t.unregister(),console.log("\uD83D\uDDD1️ Unregistered service worker:",t.scope);console.log("ℹ️ Service Worker disabled - PWA install still available via browser")})})},[]),(0,s.jsxs)("html",{lang:"en",children:[(0,s.jsxs)("head",{children:[(0,s.jsx)("link",{rel:"icon",href:"/icon-192x192.png?v=3",type:"image/png"}),(0,s.jsx)("link",{rel:"shortcut icon",href:"/icon-192x192.png?v=3",type:"image/png"}),(0,s.jsx)("link",{rel:"manifest",href:"/manifest.json?v=3"}),(0,s.jsx)("meta",{name:"theme-color",content:"#3b82f6"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"}),(0,s.jsx)("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),(0,s.jsx)("meta",{name:"mobile-web-app-capable",content:"yes"}),(0,s.jsx)("meta",{name:"apple-mobile-web-app-status-bar-style",content:"default"}),(0,s.jsx)("meta",{name:"apple-mobile-web-app-title",content:"Expenfyre"}),(0,s.jsx)("link",{rel:"apple-touch-icon",href:"/icon-192x192.png?v=3"}),(0,s.jsx)("link",{rel:"apple-touch-icon",sizes:"192x192",href:"/icon-192x192.png?v=3"}),(0,s.jsx)("link",{rel:"apple-touch-icon",sizes:"512x512",href:"/icon-512x512.png?v=3"}),(0,s.jsx)("meta",{name:"msapplication-TileImage",content:"/icon-192x192.png?v=3"}),(0,s.jsx)("meta",{name:"msapplication-TileColor",content:"#3b82f6"}),(0,s.jsx)("title",{children:"Expenfyre - Expense Tracker"}),(0,s.jsx)("meta",{name:"description",content:"Modern expense tracking and financial management application"})]}),(0,s.jsx)("body",{className:"bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200",children:(0,s.jsx)(l.N,{children:(0,s.jsx)(n.tE,{children:(0,s.jsx)(a.o,{children:(0,s.jsx)(o.s,{children:(0,s.jsxs)(p,{children:[t,(0,s.jsx)(c,{}),(0,s.jsx)(h,{}),(0,s.jsx)(x,{})]})})})})})})]})}},9910:(e,t,r)=>{"use strict";r.d(t,{E:()=>l,M:()=>i});var s=r(2381),n=r(665),a=r(4262);let o=(0,n.createContext)(void 0);function i(e){let{children:t,user:r}=e,[i,l]=(0,n.useState)([]),[c,d]=(0,n.useState)([]),[u,h]=(0,n.useState)([]),[m,x]=(0,n.useState)({expenses:!1,budgets:!1,categories:!1}),[f,p]=(0,n.useState)({expenses:null,budgets:null,categories:null}),g=async()=>{if(r){x(e=>({...e,expenses:!0}));try{let e=await (0,a.Ud)("/api/expenses");if(e.ok){let t=await e.json();l(t.data||[]),p(e=>({...e,expenses:null}))}else p(e=>({...e,expenses:"Failed to fetch expenses"}))}catch(e){p(e=>({...e,expenses:"Failed to fetch expenses"}))}finally{x(e=>({...e,expenses:!1}))}}},b=async()=>{if(r){x(e=>({...e,budgets:!0}));try{let e=await (0,a.Ud)("/api/budgets");if(e.ok){let t=await e.json();d(t.data||[]),p(e=>({...e,budgets:null}))}else p(e=>({...e,budgets:"Failed to fetch budgets"}))}catch(e){p(e=>({...e,budgets:"Failed to fetch budgets"}))}finally{x(e=>({...e,budgets:!1}))}}},v=async()=>{if(r){x(e=>({...e,categories:!0}));try{let e=await (0,a.Ud)("/api/categories");if(e.ok){let t=await e.json();h(t.data||[]),p(e=>({...e,categories:null}))}else p(e=>({...e,categories:"Failed to fetch categories"}))}catch(e){p(e=>({...e,categories:"Failed to fetch categories"}))}finally{x(e=>({...e,categories:!1}))}}};(0,n.useEffect)(()=>{r?(g(),b(),v()):(l([]),d([]),h([]))},[r]);let k=(0,n.useMemo)(()=>e=>i.filter(t=>t.month===e),[i]),w=(0,n.useMemo)(()=>e=>c.filter(t=>t.month===e),[c]),j=(0,n.useMemo)(()=>e=>u.find(t=>t.category_id===e),[u]),y=(0,n.useMemo)(()=>e=>c.find(t=>t.budget_id===e),[c]),C=async e=>{await g()},N=async(e,t)=>{await g()},S=async e=>{await g()},T=async e=>{await b()},L=async(e,t)=>{await b()},E=async e=>{await b()};return(0,s.jsx)(o.Provider,{value:{expenses:i,budgets:c,categories:u,loading:m,error:f,refetchExpenses:g,refetchBudgets:b,refetchCategories:v,invalidateCache:e=>{"all"!==e&&e&&"expenses"!==e||g(),"all"!==e&&e&&"budgets"!==e||b(),"all"!==e&&e&&"categories"!==e||v()},getExpensesByMonth:k,getBudgetsByMonth:w,getCategoryById:j,getBudgetById:y,addExpense:C,updateExpense:N,deleteExpense:S,addBudget:T,updateBudget:L,deleteBudget:E},children:t})}function l(){let e=(0,n.useContext)(o);if(void 0===e)throw Error("useData must be used within a DataProvider");return e}}},e=>{e.O(0,[587,448,621,358],()=>e(e.s=8330)),_N_E=e.O()}]);